<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Psychiatric DSM‑5 Diagnosis Builder — Unified (v2)</title>
<style>
  :root { --gap: 12px; --pad: 14px; }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, "Noto Sans KR", sans-serif; margin: 0; background: #0b0f14; color: #e6edf3; }
  header { padding: 18px var(--pad); border-bottom: 1px solid #1f2937; background: #0e141b; position: sticky; top: 0; z-index: 20;}
  h1 { font-size: 18px; margin: 0; }
  p.sub { margin: 4px 0 0; color: #93a2b8; font-size: 12px; }
  main { padding: 16px var(--pad) 96px; max-width: 1100px; margin: 0 auto; }
  .toolbar { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0 16px; }
  .tabbtn { padding: 8px 12px; border-radius: 999px; border: 1px solid #2a3e55; background: #0b1724; color: #cfe0ee; cursor: pointer; font-size: 13px; }
  .tabbtn.active { background: #12304a; border-color: #3b5f7c; }
  .wrap { display: none; }
  .wrap.active { display: block; }
  .grid { display: grid; grid-template-columns: 1fr; gap: var(--gap); }
  @media (min-width: 900px) { .grid { grid-template-columns: 1.25fr 1fr; } }
  .card { background: #111827; border: 1px solid #1f2937; border-radius: 14px; padding: 16px; }
  label { display: block; font-weight: 600; font-size: 13px; margin-bottom: 6px; color: #cdd9e5; }
  select, input[type="text"] { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #243244; background: #0b1220; color: #e6edf3; }
  select:disabled { opacity: 0.6; }
  .help { font-size: 12px; color: #93a2b8; }
  .result-card { margin-top: 16px; padding: 14px; border-radius: 12px; background: #09111a; border: 1px dashed #274560; }
  .result { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 14px; }
  .btns { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 12px; }
  button { padding: 10px 14px; border: 1px solid #264766; border-radius: 10px; background: #0b1724; color: #e6edf3; cursor: pointer; }
  button:hover { background: #102336; }
  .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 11px; border: 1px solid #2a3e55; color: #9fb6cc; }
  .indent { margin-left: 28px; }
  footer { position: fixed; bottom: 0; left: 0; right: 0; background: #0e141b; border-top: 1px solid #1f2937; padding: 10px var(--pad); font-size: 12px; color: #8aa2b5; display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
  .grow { flex: 1 1 auto; min-width: 200px; }
  .kbd { border: 1px solid #3a4a5a; background: #0c1b2a; border-radius: 6px; padding: 1px 6px; font-size: 11px; color:#a9bfd2;}
</style>
<style>
        #mdd-criteria li { margin: 4px 0 6px 56px; text-indent: -24px; line-height: 1.4; }
        #mdd-criteria label { display: inline-block; padding-left: 6px; }
        </style><style>
/* === Scoped control sizing (non-destructive) === */
.wrap .card select,
.wrap .card input[type="text"] {
  /* Fill available space up to a comfortable max; never exceed */
  width: 100%;
  max-width: clamp(220px, 42ch, 360px);
}

/* Make the short fields a touch narrower by ID (optional, safe) */
#mdd-episode, #scz-course, #bp-epi { max-width: clamp(180px, 32ch, 240px); }
#mdd-severity, #scz-sev, #gad-sev, #bp-sev { max-width: clamp(200px, 36ch, 280px); }
#mdd-remission, #bp-rem, #scz-status { max-width: clamp(200px, 36ch, 280px); }
#gad-spec, #scz-cat, #mdd-anx-level, #bp-anx-level { max-width: clamp(220px, 40ch, 320px); }

/* Keep result panels full-width */
.result-card { max-width: none; }
</style><style>
/* Criteria A visual */
.criteriaA { display: grid; grid-template-columns: auto 1fr; gap: 10px; align-items: stretch; margin: 8px 0 10px; }
.criteriaA-badge { width: 32px; height: 32px; display:flex; align-items:center; justify-content:center;
  background: #0f172a; border: 2px solid #334155; border-radius: 6px; font-weight: 800; }
.criteriaA-lines { display: grid; gap: 6px; }
.criteriaA-line { background: #0b1220; border: 1px solid #243244; border-radius: 8px; padding: 8px 12px; font-weight: 600; }
/* Checklist box already styled earlier; keep as is */
</style><style>
.criteriaA-line { margin: 2px 0; font-weight:600; white-space:pre; }
</style><style>
.criteriaA-line { margin: 2px 0; font-weight:600; }
</style><style>
.criteriaA-line { margin: 2px 0; font-weight: normal; }
body { font-family: 'Noto Sans KR', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; }
</style><style>
.criteriaA-line { display:block; margin: 2px 0; font-weight: normal; }
</style><style>
/* Disorder input narrower */
#mdd-disorder, #scz-dis, #gad-dis, #panic-dis, #bp-type {
  max-width: 260px !important;
}

/* Criteria checklist box smaller width */
#mdd-criteria {
  display: inline-block;
  max-width: 600px;
  width: auto;
}
</style><style>
/* === Responsive tweaks === */

/* Controls scale fluidly with container width */
.wrap .card select,
.wrap .card input[type="text"] {
  width: 100%;
  max-width: clamp(200px, 48vw, 360px);
}

/* MDD Criteria: stretch on desktop, shrink on mobile without awkward wraps */
#mdd-criteria {
  display: block;
  width: 100%;
  max-width: clamp(320px, 90vw, 800px);
  min-width: auto;
}

/* Number/body spacing stays tidy across sizes */
#mdd-criteria li {
  margin: 3px 0 3px clamp(28px, 6vw, 40px);
  text-indent: -18px;
  line-height: 1.45;
}

/* Criteria A lines: scale text a bit smaller on narrow screens */
.criteriaA-line {
  font-size: clamp(12px, 2.7vw, 13px);
}

/* Scales card: responsive font and spacing */
#wrap-mdd .card ul {
  line-height: clamp(1.35, 3.2vw, 1.45);
  font-size: clamp(12px, 2.8vw, 13px);
}

/* Grid: stack on small screens for better readability */
@media (max-width: 720px) {
  .grid {
    grid-template-columns: 1fr !important;
  }
  .toolbar {
    gap: 6px;
  }
  .btns {
    gap: 8px;
  }
  /* Make result and scale cards full-width */
  .result-card, #mdd-scales, #wrap-mdd .card {
    max-width: 100%;
  }
}
</style><style>
/* Make all cards and inner boxes responsive */
.wrap .card {
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
}
/* MDD criteria box responsive */
#mdd-criteria {
  display: block;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  border: 1px solid #334155;
  border-radius: 8px;
  background: #0d1117;
  padding: 10px 16px;
  margin: 6px 0;
}
/* Responsive list indentation for numbers */
#mdd-criteria li {
  margin: 3px 0 3px clamp(22px, 5vw, 36px);
  text-indent: -18px;
  line-height: 1.45;
}
/* Result cards and custom scale card fill container */
.result-card,
#wrap-mdd .card:has(> div[style*="Depression Rating Scales"]) {
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
}

/* Inputs/selects scale with container, but don't get too wide */
.wrap .card select,
.wrap .card input[type="text"] {
  width: 100%;
  max-width: clamp(220px, 48vw, 360px);
}

/* Grid stays 1-col on small screens */
@media (max-width: 720px) {
  .grid { grid-template-columns: 1fr !important; }
}
</style><style>
#mdd-criteria li { list-style-type: none !important; }
#mdd-criteria label::before { content: none !important; }
</style><style>
#mdd-criteria li, #mdd-criteria label, #mdd-criteria {
  font-weight: normal !important;
}
</style><style>
label[for*="spec"], .mdd-spec + span, .bp-spec + span, .gad-spec + span, .scz-cat + span {
  font-weight: normal !important;
}
</style><style>
/* ===== Mobile/Tablet Friendly Layout ===== */

/* Base tweaks */
:root{
  --space-1: 6px;
  --space-2: 10px;
  --radius: 12px;
}
/* Make form controls easier to tap */
.wrap .card select,
.wrap .card input[type="text"]{
  width: 100%;
  max-width: 100%;
  min-height: 40px;
  line-height: 1.2;
}

/* Ensure all cards and result sections fill container width responsively */
.wrap .card, .result-card{
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
}

/* Checklist: allow natural wrapping, keep tidy spacing */
#mdd-criteria{
  display:block;
  width: 100%;
  max-width: 100%;
  padding: var(--space-2) calc(var(--space-2) + 4px);
  border-radius: var(--radius);
  box-sizing: border-box;
}
#mdd-criteria li{
  margin: 4px 0 6px 32px;
  text-indent: -18px;
  line-height: 1.5;
}

/* Buttons: bigger touch targets, wrap nicely */
.btns button{
  min-height: 42px;
  padding: 10px 14px;
  border-radius: 12px;
}
.btns{
  gap: 10px;
  flex-wrap: wrap;
}

/* Title version stays subtle */
header h1 span#dyn-version{
  font-size: 0.72em;
}

/* ===== Breakpoint: tablets (<= 900px) ===== */
@media (max-width: 900px){
  .grid{ grid-template-columns: 1fr !important; }
  header{ position: sticky; top: 0; }
  main{ padding: 12px 12px 88px; }
  label{ font-size: 13px; }
  .help{ font-size: 12px; }
  .tabbtn{ padding: 8px 10px; font-size: 13px; }
  /* Place copy/reset under active tab's result (script already handles placement) */
  .result-card{ margin-bottom: 8px; }
}

/* ===== Breakpoint: phones (<= 560px) ===== */
@media (max-width: 560px){
  /* Compact typography using clamp for readability */
  body{ font-size: clamp(12px, 3.6vw, 14px); }
  header h1{ font-size: clamp(16px, 5.2vw, 18px); }
  .tabbtn{ font-size: 12px; }
  /* Make specifier labels wrap cleanly and easier to tap */
  #wrap-mdd .card label, 
  #wrap-scz .card label,
  #wrap-gad .card label,
  #wrap-panic .card label,
  #wrap-bipolar .card label{
    line-height: 1.55;
  }
  /* Specifier checkbox list indentation a touch lighter */
  input.mdd-spec + span, input.bp-spec + span{ margin-left: 2px; }
  /* Checklist tighter indent on small screens */
  #mdd-criteria li{ margin-left: 26px; text-indent: -16px; line-height: 1.45; }
  /* Buttons stretch 2-up on small screens */
  .btns button{ flex: 1 1 calc(50% - 10px); }
}

/* ===== Extra small phones (<= 380px) ===== */
@media (max-width: 380px){
  /* Stack buttons full width for tiny screens */
  .btns button{ flex: 1 1 100%; }
  /* Slightly reduce paddings */
  .card{ padding: 12px; }
  .result-card{ padding: 12px; }
  #mdd-criteria{ padding: 10px 12px; }
  /* Criteria A lines font-size a bit smaller */
  .criteriaA-line{ font-size: 12px; }
}
</style><style>
/* Revert dropdowns to compact sizing */
.wrap .card select,
.wrap .card input[type="text"] {
  width: auto !important;
  min-width: 200px;
  max-width: 340px;
}
</style><style>
/* Revert dropdowns/inputs height to normal compact style */
.wrap .card select,
.wrap .card input[type="text"] {
  height: auto !important;
  min-height: unset !important;
  padding: 2px 6px !important;
  line-height: normal !important;
  font-size: 14px;
}
</style><style>
.spec-header { display:flex; align-items:center; justify-content:space-between; gap:8px; }
#btn-mdd-specifiers {
  width: 28px; height: 28px;
  display:inline-flex; align-items:center; justify-content:center;
  border-radius: 6px;
  border: 1px solid #2a3e55;
  background:#0b1724; color:#cfe0ee; cursor:pointer;
  font-size:14px; line-height:1;
}
#btn-mdd-specifiers:hover { background:#102336; }
</style><style>
/* Make A. criteria lines responsive and prevent overflow */
.criteriaA-line{
  font-size: clamp(12px, 2.5vw, 14px);
  white-space: normal !important;      /* allow wrapping */
  overflow-wrap: break-word;           /* modern wrap */
  word-wrap: break-word;               /* legacy wrap */
  word-break: break-word;              /* extreme fallback */
  max-width: 100%;
}
</style><style>
#page-mdd-specifiers ul { margin-left: 14px !important; padding-left: 14px !important; }
#page-mdd-specifiers li { margin: 2px 0; }
</style><style>
/* Apply responsive clamp font sizing globally */
body, .wrap .card, .criteriaA-line, .result-card, 
#page-mdd-specifiers pre, #page-mdd-specifiers, 
#page-mdd-specifiers ul, #page-mdd-specifiers li {
  font-size: clamp(12px, 2.5vw, 14px) !important;
  line-height: 1.5;
}
</style><style>
/* Fix indentation for Depression Rating Scales list */
#wrap-mdd .card ul {
  margin-left: 16px !important;   /* modest indent */
  padding-left: 16px !important;
  line-height: 1.45;
}
#wrap-mdd .card ul li {
  margin: 2px 0;
}
</style></head>
<body>
<header>
<h1><span>DSM-5 Diagnosis Builder</span><span id="dyn-version" style="font-size:0.7em; margin-left:6px; color:#94a3b8;">(v—)</span></h1>
</header>
<main>
<div class="toolbar">
<button class="tabbtn active" data-tab="mdd">MDD</button><button class="tabbtn" data-tab="scz">Schizophrenia</button><button class="tabbtn" data-tab="bipolar">Bipolar</button><button class="tabbtn" data-tab="panic">Panic Disorder</button><button class="tabbtn" data-tab="gad">GAD</button><span class="grow"></span>
</div>
<!-- MDD (Pro) -->
<section class="wrap active" id="wrap-mdd">
<div class="grid">
<div class="card">
<label>Disorder</label>
<input id="mdd-disorder" readonly="" type="text" value="Major Depressive Disorder"/>
<label style="margin-top:12px;">Episode</label>
<select id="mdd-episode">
<option value="">-- Select --</option>
<option value="single episode">single episode</option>
<option value="recurrent">recurrent</option>
</select>
<label style="margin-top:12px;">Severity</label>
<select id="mdd-severity">
<option value="">-- Select --</option>
<option value="mild">mild</option>
<option value="moderate">moderate</option>
<option value="severe without psychotic features">severe without psychotic features</option>
<option value="severe with psychotic features">severe with psychotic features</option>
</select>
<div class="spec-header"><label style="margin-top:12px;">Specifier(s) <span class="pill">multi‑select</span></label><button id="btn-mdd-specifiers" title="명시자 안내 페이지로 이동" type="button">➔</button></div>
<div>
<label style="margin-left:2px; font-weight: normal !important;"><input class="mdd-spec" id="mdd-spec-anx" type="checkbox" value="with anxious distress"/> with anxious distress</label>
<div class="indent" id="mdd-anx-wrap" style="display:none;">
<label class="help">anxious distress 강도</label>
<select id="mdd-anx-level">
<option value="">(unspecified)</option>
<option value="(mild)">mild</option>
<option value="(moderate)">moderate</option>
<option value="(moderate-severe)">moderate-severe</option>
<option value="(severe)">severe</option>
</select>
</div>
<label style="margin-left:2px; font-weight: normal !important;"><input class="mdd-spec" type="checkbox" value="with mixed features"/> with mixed features</label>
<label style="margin-left:2px; font-weight: normal !important;"><input class="mdd-spec" type="checkbox" value="with melancholic features"/> with melancholic features</label>
<label style="margin-left:2px; font-weight: normal !important;"><input class="mdd-spec" type="checkbox" value="with atypical features"/> with atypical features</label>
<label style="margin-left:2px; font-weight: normal !important;"><input class="mdd-spec" type="checkbox" value="with catatonia"/> with catatonia</label>
<label style="margin-left:2px; font-weight: normal !important;"><input class="mdd-spec" type="checkbox" value="with peripartum onset"/> with peripartum onset</label>
<label style="margin-left:2px; font-weight: normal !important;"><input class="mdd-spec" id="mdd-spec-season" type="checkbox" value="with seasonal pattern"/> with seasonal pattern <span class="help">*(recurrent만 허용)</span></label>
</div>
<label style="margin-top:12px;">Remission status</label>
<select id="mdd-remission">
<option value="">-- None --</option>
<option value="in partial remission">in partial remission</option>
<option value="in full remission">in full remission</option>
</select>
</div>
<div class="card">
<div class="result-card"><div class="help">Generated diagnosis</div><div class="result" id="mdd-result" style="margin-top:6px;">(선택값을 입력하세요)</div><div class="btns" id="global-copy-reset"><button id="copyCurrent">Copy current</button><button id="resetCurrent">Reset current</button></div></div><div class="card" style="margin-top:12px;"><div style="font-weight:600; margin-bottom:4px; font-size:13px;">📊 Depression Rating Scales</div><ul style="margin:4px 0 0 6px; line-height:1.4; font-size:13px;"><li>1차 진료 및 간편검사: PHQ-9</li><li>기타 널리 사용: BDI-II</li><li>임상시험 Gold Standard: HAM-D, MADRS</li><li>역학/대규모 연구: CES-D</li></ul></div>
</div>
</div>
<!-- Added reference block -->
<div class="card" style="margin-top:12px;"><div class="criteriaA" style="display:block; margin:6px 0;"><div class="criteriaA-line" style="font-size:13px; margin:2px 0;">A. 총 9개 항목 중 5개 이상이 2주 이상 지속되며, 이전 기능과 비교해 명확한 변화</div><div class="criteriaA-line" style="font-size:13px; margin:2px 0;">A. 1. 우울한 기분 또는 2. 흥미·즐거움 상실 중 하나를 포함</div></div><ul id="mdd-criteria"><li class="symptom" style="margin:3px 0 3px 40px; text-indent:-18px;"><label><input data-idx="1" type="checkbox"/> 1. 우울한 기분(주관적 보고 또는 관찰자에 의한 관찰)</label></li><li class="symptom" style="margin:3px 0 3px 40px; text-indent:-18px;"><label><input data-idx="2" type="checkbox"/> 2. 흥미나 즐거움의 현저한 감소(거의 모든 활동)</label></li><li class="symptom" style="margin:3px 0 3px 40px; text-indent:-18px;"><label><input data-idx="3" type="checkbox"/> 3. 식욕 또는 체중의 변화(증가/감소)</label></li><li class="symptom" style="margin:3px 0 3px 40px; text-indent:-18px;"><label><input data-idx="4" type="checkbox"/> 4. 수면 문제(불면증 또는 과수면)</label></li><li class="symptom" style="margin:3px 0 3px 40px; text-indent:-18px;"><label><input data-idx="5" type="checkbox"/> 5. 정신운동성 초조 또는 지체</label></li><li class="symptom" style="margin:3px 0 3px 40px; text-indent:-18px;"><label><input data-idx="6" type="checkbox"/> 6. 피로감 또는 활력 상실</label></li><li class="symptom" style="margin:3px 0 3px 40px; text-indent:-18px;"><label><input data-idx="7" type="checkbox"/> 7. 무가치감 또는 과도한/부적절한 죄책감</label></li><li class="symptom" style="margin:3px 0 3px 40px; text-indent:-18px;"><label><input data-idx="8" type="checkbox"/> 8. 사고력/집중력 저하 또는 우유부단</label></li><li class="symptom" style="margin:3px 0 3px 40px; text-indent:-18px;"><label><input data-idx="9" type="checkbox"/> 9. 반복적 죽음/자살 사고, 계획, 시도</label></li></ul><div id="mdd-status" style="margin-top:10px; font-weight:600; color:#9ccfd8;">(진단 충족 여부가 여기에 표시됩니다)</div><script>
    (function() {
      const boxes = document.querySelectorAll('#mdd-criteria .symptom input[type="checkbox"]');
      const statusEl = document.getElementById('mdd-status');
      function update() {
        const checkedIdx = Array.from(boxes).filter(cb => cb.checked).map(cb => Number(cb.dataset.idx));
        const count = checkedIdx.length;
        const hasCore = checkedIdx.includes(1) || checkedIdx.includes(2);
        const ok = count >= 5 && hasCore;
        statusEl.textContent = ok ? "✅ 진단 충족" : "❌ 진단 불충족";
        statusEl.style.color = ok ? "#4ade80" : "#f87171";
      }
      boxes.forEach(cb => cb.addEventListener('change', update));
      update();
    })();
    </script></div>
</section>
<!-- Schizophrenia -->
<section class="wrap" id="wrap-scz">
<div class="grid">
<div class="card">
<label>Disorder</label>
<input id="scz-dis" readonly="" type="text" value="Schizophrenia"/>
<label style="margin-top:12px;">Course</label>
<select id="scz-course">
<option value="">-- Select --</option>
<option value="first episode">first episode</option>
<option value="multiple episodes">multiple episodes</option>
<option value="continuous">continuous</option>
<option value="unspecified">unspecified</option>
</select>
<label style="margin-top:12px;">Current status</label>
<select id="scz-status">
<option value="">-- Select --</option>
<option value="currently in acute episode">currently in acute episode</option>
<option value="currently in partial remission">currently in partial remission</option>
<option value="currently in full remission">currently in full remission</option>
<option value="current status unspecified">current status unspecified</option>
</select>
<label style="margin-top:12px;">Specifier</label>
<select id="scz-cat">
<option value="">-- None --</option>
<option value="with catatonia">with catatonia</option>
</select>
<label style="margin-top:12px;">Severity (0–4, 선택)</label>
<select id="scz-sev">
<option value="">-- Not specified --</option>
<option value="severity: 0">severity: 0</option>
<option value="severity: 1">severity: 1</option>
<option value="severity: 2">severity: 2</option>
<option value="severity: 3">severity: 3</option>
<option value="severity: 4">severity: 4</option>
</select>
</div>
<div class="card">
<div class="result-card"><div class="help">Generated diagnosis</div><div class="result" id="scz-result" style="margin-top:6px;">(선택값을 입력하세요)</div></div>
</div>
</div>
</section>
<!-- GAD -->
<section class="wrap" id="wrap-gad">
<div class="grid">
<div class="card">
<label>Disorder</label>
<input id="gad-dis" readonly="" type="text" value="Generalized Anxiety Disorder"/>
<label style="margin-top:12px;">Specifier</label>
<select id="gad-spec">
<option value="">-- None --</option>
<option value="with panic attacks">with panic attacks</option>
</select>
<label style="margin-top:12px;">Optional severity (임상 표기)</label>
<select id="gad-sev">
<option value="">-- Not specified --</option>
<option value="mild">mild</option>
<option value="moderate">moderate</option>
<option value="severe">severe</option>
</select>
</div>
<div class="card">
<div class="result-card"><div class="help">Generated diagnosis</div><div class="result" id="gad-result" style="margin-top:6px;">(선택값을 입력하세요)</div></div>
</div>
</div>
</section>
<!-- Panic Disorder -->
<section class="wrap" id="wrap-panic">
<div class="grid">
<div class="card">
<label>Disorder</label>
<input id="panic-dis" readonly="" type="text" value="Panic Disorder"/>
<label style="margin-top:12px;">Optional note (free text)</label>
<input id="panic-note" placeholder="예: nocturnal panic attacks (임상 메모)" type="text"/>
<div class="help">* Panic Disorder 자체에는 “with panic attacks” 중복 표기하지 않습니다.</div>
</div>
<div class="card">
<div class="result-card"><div class="help">Generated diagnosis</div><div class="result" id="panic-result" style="margin-top:6px;">(선택값을 입력하세요)</div></div>
</div>
</div>
</section>
<!-- Bipolar -->
<section class="wrap" id="wrap-bipolar">
<div class="grid">
<div class="card">
<label>Type</label>
<select id="bp-type">
<option value="">-- Select --</option>
<option value="Bipolar I Disorder">Bipolar I Disorder</option>
<option value="Bipolar II Disorder">Bipolar II Disorder</option>
</select>
<label style="margin-top:12px;">Current/Most recent episode</label>
<select id="bp-epi">
<option value="">-- Select --</option>
<option value="manic">manic</option>
<option value="hypomanic">hypomanic</option>
<option value="depressive">depressive</option>
<option value="unspecified">unspecified</option>
</select>
<label style="margin-top:12px;">Severity (episode‑specific)</label>
<select id="bp-sev">
<option value="">-- Select --</option>
<option value="mild">mild</option>
<option value="moderate">moderate</option>
<option value="severe without psychotic features">severe without psychotic features</option>
<option value="severe with psychotic features">severe with psychotic features</option>
</select>
<div class="help">* hypomanic에는 psychotic features가 적용되지 않습니다.</div>
<label style="margin-top:12px;">Specifier(s) <span class="pill">multi‑select</span></label>
<div>
<label style="margin-left:2px; font-weight: normal !important;"><input class="bp-spec" id="bp-spec-anx" type="checkbox" value="with anxious distress"/> with anxious distress</label>
<select id="bp-anx-level" style="margin-left:10px;">
<option value="">(unspecified)</option>
<option value="(mild)">mild</option>
<option value="(moderate)">moderate</option>
<option value="(moderate-severe)">moderate-severe</option>
<option value="(severe)">severe</option>
</select>
<label style="margin-left:2px; font-weight: normal !important;"><input class="bp-spec" type="checkbox" value="with mixed features"/> with mixed features</label>
<label style="margin-left:2px; font-weight: normal !important;"><input class="bp-spec" type="checkbox" value="with rapid cycling"/> with rapid cycling</label>
<label style="margin-left:2px; font-weight: normal !important;"><input class="bp-spec" type="checkbox" value="with peripartum onset"/> with peripartum onset</label>
<label style="margin-left:2px; font-weight: normal !important;"><input class="bp-spec" type="checkbox" value="with seasonal pattern"/> with seasonal pattern</label>
</div>
<label style="margin-top:12px;">Remission status</label>
<select id="bp-rem">
<option value="">-- None --</option>
<option value="in partial remission">in partial remission</option>
<option value="in full remission">in full remission</option>
</select>
</div>
<div class="card">
<div class="result-card"><div class="help">Generated diagnosis</div><div class="result" id="bp-result" style="margin-top:6px;">(선택값을 입력하세요)</div></div>
</div>
</div>
</section>
</main>
<footer>
<span>현재 탭 결과를 복사하려면 <span class="kbd">Copy current</span> 를 누르세요. 초기화는 <span class="kbd">Reset current</span>.</span>
</footer>
<script>
    // Tab switching
    const tabs = Array.from(document.querySelectorAll('.tabbtn'));
    const wraps = {
      mdd: document.getElementById('wrap-mdd'),
      scz: document.getElementById('wrap-scz'),
      gad: document.getElementById('wrap-gad'),
      panic: document.getElementById('wrap-panic'),
      bipolar: document.getElementById('wrap-bipolar'),
    };
    let current = 'mdd';
    tabs.forEach(btn => btn.addEventListener('click', () => {
      tabs.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      Object.values(wraps).forEach(w => w.classList.remove('active'));
      current = btn.dataset.tab;
      wraps[current].classList.add('active');
      buildAll();
    }));

    // ===== MDD (Pro) logic =====
    const mddEl = {
      disorder: document.getElementById('mdd-disorder'),
      episode: document.getElementById('mdd-episode'),
      severity: document.getElementById('mdd-severity'),
      remission: document.getElementById('mdd-remission'),
      result: document.getElementById('mdd-result'),
      anx: document.getElementById('mdd-spec-anx'),
      anxWrap: document.getElementById('mdd-anx-wrap'),
      anxLevel: document.getElementById('mdd-anx-level'),
      season: document.getElementById('mdd-spec-season'),
      specBoxes: Array.from(document.querySelectorAll('.mdd-spec'))
    };
    function mddUpdateSeason() {
      if (mddEl.episode.value !== 'recurrent') {
        mddEl.season.checked = false;
        mddEl.season.disabled = true;
      } else mddEl.season.disabled = false;
    }
    function mddBuild() {
      mddUpdateSeason();
      const parts = [mddEl.disorder.value.trim()];
      if (mddEl.episode.value) parts.push(mddEl.episode.value);
      if (mddEl.severity.value) parts.push(mddEl.severity.value);

      const specs = [];
      mddEl.specBoxes.forEach(cb => {
        if (cb.checked) {
          if (cb.value === 'with anxious distress') {
            const lvl = mddEl.anxLevel.value || '';
            specs.push(lvl ? cb.value + ' ' + lvl : cb.value);
          } else specs.push(cb.value);
        }
      });
      if (specs.length) parts.push(...specs);
      if (mddEl.remission.value) parts.push(mddEl.remission.value);
      mddEl.result.textContent = parts.join(', ') || '(선택값을 입력하세요)';
    }
    [mddEl.episode, mddEl.severity, mddEl.remission].forEach(el => el.addEventListener('change', mddBuild));
    mddEl.specBoxes.forEach(cb => cb.addEventListener('change', () => {
      if (cb === mddEl.anx) mddEl.anxWrap.style.display = mddEl.anx.checked ? 'block' : 'none';
      mddBuild();
    }));
    mddEl.anxLevel.addEventListener('change', mddBuild);

    // ===== Schizophrenia logic =====
    const sczEl = {
      dis: document.getElementById('scz-dis'),
      course: document.getElementById('scz-course'),
      status: document.getElementById('scz-status'),
      cat: document.getElementById('scz-cat'),
      sev: document.getElementById('scz-sev'),
      result: document.getElementById('scz-result')
    };
    function sczValidate() {
      if (sczEl.course.value === 'continuous') {
        sczEl.status.value = '';
        sczEl.status.disabled = true;
      } else sczEl.status.disabled = false;
    }
    function sczBuild() {
      sczValidate();
      const p = [sczEl.dis.value.trim()];
      if (sczEl.course.value) p.push(sczEl.course.value);
      if (sczEl.status.value) p.push(sczEl.status.value);
      if (sczEl.cat.value) p.push(sczEl.cat.value);
      if (sczEl.sev.value) p.push(sczEl.sev.value);
      sczEl.result.textContent = p.join(', ') || '(선택값을 입력하세요)';
    }
    [sczEl.course, sczEl.status, sczEl.cat, sczEl.sev].forEach(el => el.addEventListener('change', sczBuild));

    // ===== GAD logic =====
    const gadEl = {
      dis: document.getElementById('gad-dis'),
      spec: document.getElementById('gad-spec'),
      sev: document.getElementById('gad-sev'),
      result: document.getElementById('gad-result')
    };
    function gadBuild() {
      const p = [gadEl.dis.value.trim()];
      if (gadEl.spec.value) p.push(gadEl.spec.value);
      if (gadEl.sev.value) p.push(gadEl.sev.value);
      gadEl.result.textContent = p.join(', ');
    }
    [gadEl.spec, gadEl.sev].forEach(el => el.addEventListener('change', gadBuild));

    // ===== Panic logic =====
    const panicEl = {
      dis: document.getElementById('panic-dis'),
      note: document.getElementById('panic-note'),
      result: document.getElementById('panic-result')
    };
    function panicBuild() {
      const p = [panicEl.dis.value.trim()];
      const n = (panicEl.note.value || '').trim();
      if (n) p.push(n);
      panicEl.result.textContent = p.join(', ');
    }
    panicEl.note.addEventListener('input', panicBuild);

    // ===== Bipolar logic =====
    const bpEl = {
      type: document.getElementById('bp-type'),
      epi: document.getElementById('bp-epi'),
      sev: document.getElementById('bp-sev'),
      rem: document.getElementById('bp-rem'),
      specs: Array.from(document.querySelectorAll('.bp-spec')),
      anxBox: document.getElementById('bp-spec-anx'),
      anxLevel: document.getElementById('bp-anx-level'),
      result: document.getElementById('bp-result')
    };
    function bpEnforce() {
      if (bpEl.epi.value === 'hypomanic' && bpEl.sev.value.includes('psychotic features')) {
        bpEl.sev.value = '';
      }
    }
    function bpBuild() {
      bpEnforce();
      const p = [];
      if (bpEl.type.value) p.push(bpEl.type.value);
      if (bpEl.epi.value) p.push(`current/most recent episode ${bpEl.epi.value}`);
      if (bpEl.sev.value) p.push(bpEl.sev.value);
      const specs = [];
      bpEl.specs.forEach(cb => {
        if (cb.checked) {
          if (cb.value === 'with anxious distress') {
            const lvl = bpEl.anxLevel.value || '';
            specs.push(lvl ? cb.value + ' ' + lvl : cb.value);
          } else specs.push(cb.value);
        }
      });
      if (specs.length) p.push(...specs);
      if (bpEl.rem.value) p.push(bpEl.rem.value);
      bpEl.result.textContent = p.join(', ') || '(선택값을 입력하세요)';
    }
    [bpEl.type, bpEl.epi, bpEl.sev, bpEl.rem].forEach(el => el.addEventListener('change', bpBuild));
    bpEl.specs.forEach(cb => cb.addEventListener('change', bpBuild));
    bpEl.anxLevel.addEventListener('change', () => { if (!bpEl.anxBox.checked && bpEl.anxLevel.value) bpEl.anxBox.checked = true; bpBuild(); });

    // Global buttons
    document.getElementById('copyCurrent').addEventListener('click', () => {
      const text = {
        mdd: mddEl.result.textContent,
        scz: sczEl.result.textContent,
        gad: gadEl.result.textContent,
        panic: panicEl.result.textContent,
        bipolar: bpEl.result.textContent
      }[current] || '';
      if (text && text !== '(선택값을 입력하세요)') {
        navigator.clipboard.writeText(text);
        const btn = document.getElementById('copyCurrent');
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = 'Copy current', 1200);
      }
    });
    document.getElementById('resetCurrent').addEventListener('click', () => {
      if (current === 'mdd') {
        mddEl.episode.value = ''; mddEl.severity.value = ''; mddEl.remission.value = '';
        mddEl.specBoxes.forEach(cb => cb.checked = false); mddEl.anxLevel.value = ''; mddEl.anxWrap.style.display = 'none';
      } else if (current === 'scz') {
        sczEl.course.value = ''; sczEl.status.value = ''; sczEl.cat.value = ''; sczEl.sev.value = '';
      } else if (current === 'gad') {
        gadEl.spec.value = ''; gadEl.sev.value = '';
      } else if (current === 'panic') {
        panicEl.note.value = '';
      } else if (current === 'bipolar') {
        bpEl.type.value = ''; bpEl.epi.value = ''; bpEl.sev.value = ''; bpEl.rem.value='';
        bpEl.specs.forEach(cb => cb.checked = false); bpEl.anxLevel.value = '';
      }
      buildAll();
    });

    function buildAll() { mddBuild(); sczBuild(); gadBuild(); panicBuild(); bpBuild(); }
    // init
    buildAll();
  </script>
<script>
(function(){
  function placeButtons() {
    const btns = document.getElementById('global-copy-reset');
    if (!btns) return;
    let target = null;
    const current = document.querySelector('.tabbtn.active')?.dataset?.tab || 'mdd';
    if (current === 'mdd') target = document.querySelector('#wrap-mdd .result-card');
    if (current === 'scz') target = document.querySelector('#wrap-scz .result-card');
    if (current === 'gad') target = document.querySelector('#wrap-gad .result-card');
    if (current === 'panic') target = document.querySelector('#wrap-panic .result-card');
    if (current === 'bipolar') target = document.querySelector('#wrap-bipolar .result-card');
    if (target && btns.parentElement !== target) target.appendChild(btns);
  }
  // run now and on tab clicks
  placeButtons();
  document.querySelectorAll('.tabbtn').forEach(b=>b.addEventListener('click', ()=>setTimeout(placeButtons, 0)));
})();</script><script>
(function(){
  function pad(n){return n<10? '0'+n : ''+n;}
  var d = new Date();
  var y = d.getFullYear();
  var m = pad(d.getMonth()+1);
  var day = pad(d.getDate());
  var hh = pad(d.getHours());
  var mm = pad(d.getMinutes());
  var ver = "(v" + y + m + day + "_" + hh + mm + ")";
  var el = document.getElementById("dyn-version");
  if (el) el.textContent = ver;
})();
</script><div id="page-mdd-specifiers" style="display:none; position:fixed; inset:0; background:#0b0f14; color:#e6edf3; overflow:auto; z-index:9999;"><div style="max-width:900px; margin:0 auto; padding:18px;"><div style="display:flex; align-items:center; justify-content:space-between; gap:8px; position:sticky; top:0; background:#0b0f14; padding:8px 0;"><h2 style="margin:0; font-size:18px;">우울장애의 명시자 (Specifiers for Depressive Disorders)</h2><button id="back-specifiers" style="padding:8px 12px; border:1px solid #2a3e55; background:#0b1724; color:#cfe0ee; border-radius:8px;" type="button">← 돌아가기</button></div>
<div style="margin-top:10px; line-height:1.6;">
<p style="color:#93a2b8;">DSM‑5‑TR 기준을 바탕으로 요약한 임상용 안내입니다(원문 아님).</p>
<h3 style="margin:10px 0 6px;">with anxious distress</h3>
<ul style="margin:0 0 10px 18px;">
<li>불안/긴장, 안절부절, 걱정 난제, 통제 어려움 등 불안 증상 동반</li>
<li>심각도: mild / moderate / moderate‑severe / severe</li>
</ul>
<h3 style="margin:10px 0 6px;">with mixed features</h3>
<ul style="margin:0 0 10px 18px;">
<li>우울삽화 중 조증/경조증 양상 일부가 동시에 존재</li>
<li>고양된 기분, 과도한 활동/에너지, 과대자존 등 일부 기준 충족</li>
</ul>
<h3 style="margin:10px 0 6px;">with melancholic features</h3>
<ul style="margin:0 0 10px 18px;">
<li>쾌감소실 또는 일반 활성의 현저한 즐거움 상실</li>
<li>아침 악화, 조기 각성, 정신운동성 변화, 식욕감퇴/체중감소, 과도한 죄책감 중 다수</li>
</ul>
<h3 style="margin:10px 0 6px;">with atypical features</h3>
<ul style="margin:0 0 10px 18px;">
<li>기분반응성 보존(긍정 자극에 기분 호전)</li>
<li>체중증가/과식, 과수면, 사지 납중감, 대인관계 거절 민감성 등</li>
</ul>
<h3 style="margin:10px 0 6px;">with catatonia</h3>
<ul style="margin:0 0 10px 18px;">
<li>운동성 무활동/과활동, 납굴증, 함구/거부 등 카타토니아 증후군 동반</li>
</ul>
<h3 style="margin:10px 0 6px;">with peripartum onset</h3>
<ul style="margin:0 0 10px 18px;">
<li>임신 중 또는 산후 초기 발생</li>
</ul>
<h3 style="margin:10px 0 6px;">with seasonal pattern</h3>
<ul style="margin:0 0 10px 18px;">
<li>재발성 MDD에서 특정 계절에 규칙적으로 발병/관해</li>
<li style="color:#93a2b8;">* 본 빌더에서도 recurrent일 때만 선택 가능</li>
</ul>
</div>
</div></div><script>
(function(){
  const btn = document.getElementById('btn-mdd-specifiers');
  const panel = document.getElementById('page-mdd-specifiers');
  const back = document.getElementById('back-specifiers');
  function openPanel(){ panel.style.display='block'; window.location.hash = 'mdd-specifiers'; }
  function closePanel(){ panel.style.display='none'; history.pushState('', document.title, window.location.pathname + window.location.search); }
  if (btn) btn.addEventListener('click', openPanel);
  if (back) back.addEventListener('click', closePanel);
  // Open automatically if hash present
  if (window.location.hash === '#mdd-specifiers'){ panel.style.display='block'; }
})();</script></body>
</html>
